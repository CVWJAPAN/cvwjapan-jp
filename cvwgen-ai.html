
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CVWGEN 法令連動AIチャット</title>
  <style>
    body { font-family: sans-serif; background: #f0f8ff; padding: 20px; }
    header { background: #00a9b0; color: white; padding: 1em; text-align: center; font-size: 1.4em; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
    select, textarea, input, button {
      width: 100%; padding: 10px; margin-top: 10px; font-size: 1em;
    }
    button { background-color: #0080ff; color: white; border: none; border-radius: 5px; }
    #response { white-space: pre-wrap; background: #eef; padding: 15px; margin-top: 15px; border-radius: 5px; }
  </style>
</head>
<body>
  <header>CVWGEN 法令連動AIチャット（API接続）</header>
  <div class="container">
    <label>OpenAI APIキーを入力してください：</label>
    <input type="password" id="apiKey" placeholder="sk-...">

    <label>あなたの立場：</label>
    <select id="role">
      <option value="child">子ども</option>
      <option value="parent">保護者</option>
      <option value="supporter">支援者</option>
    </select>

    <label>話したいことや悩み：</label>
    <textarea id="message" rows="5" placeholder="例：学校に行きたくない、生活費が足りない..."></textarea>

    <button onclick="askAI()">送信してAIに相談</button>

    <div id="response"></div>
  </div>

  <script>
    async function askAI() {
      const apiKey = document.getElementById("apiKey").value.trim();
      const role = document.getElementById("role").value;
      const message = document.getElementById("message").value.trim();

      if (!apiKey || !message) {
        alert("APIキーとメッセージを入力してください");
        return;
      }

      let systemPrompt = "";
      if (role === "child") {
        systemPrompt = "あなたは日本の子どもの支援員です。児童福祉法と児童虐待防止法に基づき、やさしく正確にアドバイスしてください。";
      } else if (role === "parent") {
        systemPrompt = "あなたは日本の保護者支援AIです。生活保護法、児童福祉法、貧困対策支援法に沿ってアドバイスしてください。";
      } else {
        systemPrompt = "あなたは日本の支援者向けAIです。社会福祉法、児童虐待防止法をもとに支援情報を案内してください。";
      }

      const chatBody = {
        model: "gpt-3.5-turbo",
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: message }
        ]
      };

      try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify(chatBody)
        });

        const data = await res.json();
        document.getElementById("response").innerText =
          data.choices?.[0]?.message?.content || "回答を取得できませんでした。";
      } catch (err) {
        document.getElementById("response").innerText = "エラーが発生しました：" + err.message;
      }
    }
  </script>
</body>
</html>
